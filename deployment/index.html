
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://stackhpc.github.io/reductionist-rs/deployment/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-8.5.10">
    
    
      
        <title>Deployment - Reductionist</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
        
          
          
          <meta name="theme-color" content="#ef5552">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#deployment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Reductionist" class="md-header__button md-logo" aria-label="Reductionist" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Reductionist
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Deployment
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/stackhpc/reductionist-rs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Reductionist" class="md-nav__button md-logo" aria-label="Reductionist" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Reductionist
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stackhpc/reductionist-rs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        API
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Deployment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Deployment
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ansible-control-host-setup" class="md-nav__link">
    Ansible control host setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment_1" class="md-nav__link">
    Deployment
  </a>
  
    <nav class="md-nav" aria-label="Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minimal-deployment-of-podman-and-the-reductionist" class="md-nav__link">
    Minimal deployment of Podman and the Reductionist
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-ssltls-certificates-with-the-reductionist" class="md-nav__link">
    Using SSL/TLS certificates with the Reductionist
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reductionist-configuration" class="md-nav__link">
    Reductionist Configuration
  </a>
  
    <nav class="md-nav" aria-label="Reductionist Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chunk-cache-key" class="md-nav__link">
    Chunk Cache Key
  </a>
  
    <nav class="md-nav" aria-label="Chunk Cache Key">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chunk-cache-key-tokens-available" class="md-nav__link">
    Chunk Cache Key Tokens Available
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authenticating-cached-chunks" class="md-nav__link">
    Authenticating Cached Chunks
  </a>
  
    <nav class="md-nav" aria-label="Authenticating Cached Chunks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-authentication" class="md-nav__link">
    No Authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-can-only-retrieve-chunks-that-they-cached" class="md-nav__link">
    Client can only retrieve chunks that they cached
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clients-can-retrieve-any-cached-chunks-to-which-s3-grants-access" class="md-nav__link">
    Clients can retrieve any cached chunks to which S3 grants access
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../pyactivestorage/" class="md-nav__link">
        PyActiveStorage Integration
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ansible-control-host-setup" class="md-nav__link">
    Ansible control host setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment_1" class="md-nav__link">
    Deployment
  </a>
  
    <nav class="md-nav" aria-label="Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minimal-deployment-of-podman-and-the-reductionist" class="md-nav__link">
    Minimal deployment of Podman and the Reductionist
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-ssltls-certificates-with-the-reductionist" class="md-nav__link">
    Using SSL/TLS certificates with the Reductionist
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reductionist-configuration" class="md-nav__link">
    Reductionist Configuration
  </a>
  
    <nav class="md-nav" aria-label="Reductionist Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chunk-cache-key" class="md-nav__link">
    Chunk Cache Key
  </a>
  
    <nav class="md-nav" aria-label="Chunk Cache Key">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chunk-cache-key-tokens-available" class="md-nav__link">
    Chunk Cache Key Tokens Available
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authenticating-cached-chunks" class="md-nav__link">
    Authenticating Cached Chunks
  </a>
  
    <nav class="md-nav" aria-label="Authenticating Cached Chunks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-authentication" class="md-nav__link">
    No Authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-can-only-retrieve-chunks-that-they-cached" class="md-nav__link">
    Client can only retrieve chunks that they cached
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clients-can-retrieve-any-cached-chunks-to-which-s3-grants-access" class="md-nav__link">
    Clients can retrieve any cached chunks to which S3 grants access
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/stackhpc/reductionist-rs/edit/master/docs/deployment.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">&para;</a></h1>
<p>The <a href="https://github.com/stackhpc/reductionist-rs/tree/main/deployment">deployment</a> directory in the Reductionist Git repository contains an Ansible playbook to deploy Reductionist and supporting services to one or more hosts.
The Ansible playbook allows for a secure, scale-out deployment of Reductionist, with an HAProxy load balancer proxying requests to any number of Reductionist backend servers.</p>
<p>The following services are supported:</p>
<ul>
<li>Podman engine</li>
<li>Step CA Certificate Authority (generates certificates for Reductionist)</li>
<li>Step CLI (requests and renews certificates)</li>
<li>Minio object store (optional, for testing)</li>
<li>Prometheus (monitors Reductionist and HAProxy)</li>
<li>Jaeger (distributed tracing UI)</li>
<li>Reductionist</li>
<li>HAProxy (load balancer for Reductionist)</li>
</ul>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>The existence of correctly configured hosts is assumed by this playbook.</p>
<p>The following host OS distributions have been tested and are supported:</p>
<ul>
<li>CentOS Stream 9</li>
<li>Rocky Linux 9</li>
<li>Ubuntu 24.04</li>
</ul>
<p>Currently only a single network is supported.
Several TCP ports should be accessible on this network.
This may require configuration of a firewall on the host (e.g. firewalld, ufw) or security groups in a cloud environment.</p>
<ul>
<li>SSH: 22</li>
<li>Reductionist backend: 8081</li>
<li>Reductionist frontend: 8080 (HAProxy host only)</li>
<li>Step CA: 9999 (Step CA host only)</li>
<li>Minio: 9000 (Minio host only)</li>
<li>Prometheus: 9090 (Prometheus host only)</li>
<li>Jaeger: 16686 (Jaeger host only)</li>
</ul>
<p>The Ansible control host (the host from which you will run <code>ansible-playbook</code>) should be able to resolve the hostnames of the hosts.
If names are not provided by DNS, entries may be added to <code>/etc/hosts</code> on the Ansible control host.
Issues have been reported when using Ansible with password-protected SSH private keys and SSH agent.</p>
<p>It may be desirable to host the Reductionist API on a different address, such as a hostname or public IP exposed on the host running HAProxy.
This may be configured using the <code>reductionist_host</code> variable.</p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p>An example Ansible inventory file is provided in <a href="https://github.com/stackhpc/reductionist-rs/blob/main/deployment/inventory">inventory</a> which defines all groups and maps localhost to them. For a production deployment it is more typical to deploy to one or more remote hosts.</p>
<p>The following example inventory places HAProxy, Jaeger, Prometheus and Step CA on <code>reductionist1</code>, while Reductionist is deployed on <code>reductionist1</code> and <code>reductionist2</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Example inventory for deployment to two hosts, reductionist1 and reductionist2.</span>

<span class="c1"># HAProxy load balancer.</span>
<span class="c1"># Should contain exactly one host.</span>
<span class="k">[haproxy]</span>
<span class="na">reductionist1</span>

<span class="c1"># Jaeger distributed tracing UI.</span>
<span class="c1"># Should contain at most one host.</span>
<span class="k">[jaeger]</span>
<span class="na">reductionist1</span>

<span class="c1"># Prometheus monitoring service.</span>
<span class="c1"># Should contain at most one host.</span>
<span class="k">[prometheus]</span>
<span class="na">reductionist1</span>

<span class="c1"># Reductionist servers.</span>
<span class="c1"># May contain multiple hosts.</span>
<span class="k">[reductionist]</span>
<span class="na">reductionist[1</span><span class="o">:</span><span class="s">2]</span>

<span class="c1"># Step Certificate Authority (CA).</span>
<span class="c1"># Should contain exactly one host.</span>
<span class="k">[step-ca]</span>
<span class="na">reductionist1</span>

<span class="c1"># Do not edit.</span>
<span class="k">[step:children]</span>
<span class="na">reductionist</span>

<span class="c1"># Do not edit.</span>
<span class="k">[podman:children]</span>
<span class="na">haproxy</span>
<span class="na">jaeger</span>
<span class="na">minio</span>
<span class="na">prometheus</span>
<span class="na">reductionist</span>
<span class="na">step-ca</span>
</code></pre></div>
<p>Some variables are provided to configure the deployment in the <a href="https://github.com/stackhpc/reductionist-rs/tree/main/deployment/group_vars">group_vars</a> directory. Reductionist configuration options may be specified using environment variables specified using <code>reductionist_env</code>.</p>
<h2 id="ansible-control-host-setup">Ansible control host setup<a class="headerlink" href="#ansible-control-host-setup" title="Permanent link">&para;</a></h2>
<p>Whether running Ansible on the same host as the Reductionist server(s) or a separate remote host, some setup is necessary.</p>
<p>Ensure Git and Pip are installed:
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>git<span class="w"> </span>python3-pip<span class="w"> </span><span class="c1"># Ubuntu</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>git<span class="w"> </span>python3-pip<span class="w"> </span><span class="c1"># CentOS Stream or Rocky Linux</span>
</code></pre></div></p>
<p>Clone the Reductionist source code:
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/stackhpc/reductionist-rs
</code></pre></div></p>
<p>Change to the Reductionist source code directory:
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>reductionist-rs
</code></pre></div></p>
<p>When working with Pip it's generally best to install packages into a virtual environment, to avoid modifying the system packages.
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv
<span class="nb">source</span><span class="w"> </span>venv/bin/activate
</code></pre></div></p>
<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h2>
<p>Install Python dependencies:
<div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>deployment/requirements.txt
</code></pre></div></p>
<p>Install Ansible collections:
<div class="highlight"><pre><span></span><code>ansible-galaxy<span class="w"> </span>collection<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>deployment/requirements.yml
</code></pre></div></p>
<h2 id="deployment_1">Deployment<a class="headerlink" href="#deployment_1" title="Permanent link">&para;</a></h2>
<p>Podman will be used to run containers under the same user account used for ansible deployment.
To install requisite system packages some tasks will require sudo <code>privileged</code> access.</p>
<p>To run the entire playbook as a non-privileged user prompting for a sudo password:
<div class="highlight"><pre><span></span><code>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>deployment/inventory<span class="w"> </span>deployment/site.yml<span class="w"> </span>-K
</code></pre></div></p>
<p>To run specific plays the following tags are supported and may be specified via <code>--tags &lt;tag1,tag2&gt;</code>:</p>
<ul>
<li><code>podman</code> - runs privileged tasks to install the required system packages</li>
<li><code>step-ca</code></li>
<li><code>step</code> - runs privileged tasks to install the required system packages and Step CA certificate</li>
<li><code>minio</code></li>
<li><code>prometheus</code></li>
<li><code>jaeger</code></li>
<li><code>reductionist</code></li>
<li><code>haproxy</code></li>
</ul>
<h3 id="minimal-deployment-of-podman-and-the-reductionist">Minimal deployment of Podman and the Reductionist<a class="headerlink" href="#minimal-deployment-of-podman-and-the-reductionist" title="Permanent link">&para;</a></h3>
<p>Podman is a prerequisite for running the Reductionist.
Podman can run containers as a <strong>non-privileged</strong> user, however this user must have <strong>linger</strong> enabled on their account to allow Podman to continue to run after logging out of the user session.</p>
<p>To enable <strong>linger</strong> support for the non-privileged user:
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>loginctl<span class="w"> </span>enable-linger<span class="w"> </span>&lt;non-privileged<span class="w"> </span>user&gt;
</code></pre></div></p>
<p>Alternatively, run the optional <code>podman</code> play to install Podman as a <strong>non-privileged</strong> user. The following will prompt for the sudo password to escalate privileges only for package installation and for enabling <strong>linger</strong> for the non-privileged user:
<div class="highlight"><pre><span></span><code>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>deployment/inventory<span class="w"> </span>deployment/site.yml<span class="w"> </span>--tags<span class="w"> </span>podman<span class="w"> </span>-K
</code></pre></div></p>
<p>Then to run the <code>reductionist</code> play, again as the <strong>non-privileged</strong> user:
<div class="highlight"><pre><span></span><code>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>deployment/inventory<span class="w"> </span>deployment/site.yml<span class="w"> </span>--tags<span class="w"> </span>reductionist
</code></pre></div></p>
<p>Podman containers require a manual restart after a system reboot.
This requires logging into the host(s) running the Reductionist as the <strong>non-privileged</strong> user to run:
<div class="highlight"><pre><span></span><code>podman<span class="w"> </span>restart<span class="w"> </span>reductionist
</code></pre></div></p>
<p>Automatic restart on boot can be enabled via <strong>systemd</strong>, not covered by this documentation.</p>
<h3 id="using-ssltls-certificates-with-the-reductionist">Using SSL/TLS certificates with the Reductionist<a class="headerlink" href="#using-ssltls-certificates-with-the-reductionist" title="Permanent link">&para;</a></h3>
<p>To enable <strong>https</strong> connections edit <code>deployment/group_vars/all</code> before deployment as set:</p>
<div class="highlight"><pre><span></span><code>REDUCTIONIST_HTTPS: &quot;true&quot;
</code></pre></div>
<p>Note, this is the default.</p>
<p>Create a <code>certs</code> directory under the home directory of the non-privileged deployment user, this will be done automatically and the following files will be added if Step is deployed.
If using third party certificates the following files must be added manually using the file names shown:</p>
<table>
<thead>
<tr>
<th>Filename</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>certs/key.pem</td>
<td>Private key file</td>
</tr>
<tr>
<td>certs/cert.pem</td>
<td>Certificate file including any intermediates</td>
</tr>
</tbody>
</table>
<p>Certificates can be added post Reductionist deployment but the Reductionist's container will need to be restarted afterwards.</p>
<h2 id="reductionist-configuration">Reductionist Configuration<a class="headerlink" href="#reductionist-configuration" title="Permanent link">&para;</a></h2>
<p>In addition to the <code>certs</code> configuration above the file <code>deployment/group_vars/all</code> covers the following configuration.</p>
<table>
<thead>
<tr>
<th>Ansible Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>reductionist_build_image</td>
<td>Whether to locally build the Reductionist container</td>
</tr>
<tr>
<td>reductionist_src_url</td>
<td>Source URL for the Reductionist repository</td>
</tr>
<tr>
<td>reductionist_src_version</td>
<td>Repository branch to use for local builds</td>
</tr>
<tr>
<td>reductionist_repo_location</td>
<td>Where to clone the Reductionist repository</td>
</tr>
<tr>
<td>reductionist_clone_repo</td>
<td>By default the repository cloning overwrites local changes, this disables</td>
</tr>
<tr>
<td>reductionist_name</td>
<td>Name for Reductionist container</td>
</tr>
<tr>
<td>reductionist_image</td>
<td>Container URL if downloading and not building</td>
</tr>
<tr>
<td>reductionist_tag</td>
<td>Container tag</td>
</tr>
<tr>
<td>reductionist_networks</td>
<td>List of container networks</td>
</tr>
<tr>
<td>reductionist_env</td>
<td>Configures the Reductionist environment, see table of environment variables below</td>
</tr>
<tr>
<td>reductionist_remote_certs_path</td>
<td>Path to certificates on the host</td>
</tr>
<tr>
<td>reductionist_container_certs_path</td>
<td>Path to certificates within the container</td>
</tr>
<tr>
<td>reductionist_remote_cache_path</td>
<td>Path to cache on host filesystem</td>
</tr>
<tr>
<td>reductionist_container_cache_path</td>
<td>Path to cache within the container</td>
</tr>
<tr>
<td>reductionist_volumes</td>
<td>Volumes to map from host to container</td>
</tr>
<tr>
<td>reductionist_host</td>
<td>Used when deploying HAProxy to test connectivity to backend Reductionist(s)</td>
</tr>
<tr>
<td>reductionist_cert_not_after</td>
<td>Certificate validity</td>
</tr>
</tbody>
</table>
<p>The <code>reductionist_env</code> parameter allows configuration of the environment variables passed to the Reductionist at runtime:</p>
<table>
<thead>
<tr>
<th>Environment Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>REDUCTIONIST_HOST</td>
<td>The IP address on which to listen on, default "0.0.0.0"</td>
</tr>
<tr>
<td>REDUCTIONIST_PORT</td>
<td>Port to listen on</td>
</tr>
<tr>
<td>REDUCTIONIST_HTTPS</td>
<td>Whether to enable https connections</td>
</tr>
<tr>
<td>REDUCTIONIST_CERT_FILE</td>
<td>Path to the certificate file used for https</td>
</tr>
<tr>
<td>REDUCTIONIST_KEY_FILE</td>
<td>Path to the key file used for https</td>
</tr>
<tr>
<td>REDUCTIONIST_SHUTDOWN_TIMEOUT</td>
<td>Maximum time in seconds to wait for operations to complete after receiving the 'ctrl+c' signal</td>
</tr>
<tr>
<td>REDUCTIONIST_ENABLE_JAEGER</td>
<td>Whether to enable sending traces to Jaeger</td>
</tr>
<tr>
<td>REDUCTIONIST_USE_RAYON</td>
<td>Whether to use Rayon for execution of CPU-bound tasks</td>
</tr>
<tr>
<td>REDUCTIONIST_MEMORY_LIMIT</td>
<td>Memory limit in bytes</td>
</tr>
<tr>
<td>REDUCTIONIST_HTTP_CONNECTION_LIMIT</td>
<td>HTTP connection limit</td>
</tr>
<tr>
<td>REDUCTIONIST_S3_CONNECTION_LIMIT</td>
<td>S3 connection limit</td>
</tr>
<tr>
<td>REDUCTIONIST_THREAD_LIMIT</td>
<td>Thread limit for CPU-bound tasks</td>
</tr>
<tr>
<td>REDUCTIONIST_USE_CHUNK_CACHE</td>
<td>Whether to enable caching of downloaded data objects to disk</td>
</tr>
<tr>
<td>REDUCTIONIST_CHUNK_CACHE_PATH</td>
<td>Absolute filesystem path used for the cache. Defaults to container cache path, see Ansible Parameters above</td>
</tr>
<tr>
<td>REDUCTIONIST_CHUNK_CACHE_AGE</td>
<td>Time in seconds a chunk is kept in the cache</td>
</tr>
<tr>
<td>REDUCTIONIST_CHUNK_CACHE_PRUNE_INTERVAL</td>
<td>Time in seconds between periodic pruning of the cache</td>
</tr>
<tr>
<td>REDUCTIONIST_CHUNK_CACHE_SIZE_LIMIT</td>
<td>Maximum cache size, i.e. "100GB"</td>
</tr>
<tr>
<td>REDUCTIONIST_CHUNK_CACHE_QUEUE_SIZE</td>
<td>Tokio MPSC buffer size used to queue downloaded objects between the asynchronous web engine and the synchronous cache</td>
</tr>
<tr>
<td>REDUCTIONIST_CHUNK_CACHE_KEY</td>
<td>Overrides the key format used to uniquely identify a cached chunk, see section below</td>
</tr>
<tr>
<td>REDUCTIONIST_CHUNK_CACHE_BYPASS_AUTH</td>
<td>Allow bypassing of S3 authentication when accessing cached data</td>
</tr>
</tbody>
</table>
<p>Note, after changing any of the above parameters the Reductionist must be deployed, or redeployed, using the ansible playbook for the change to take effect.
The idempotent nature of ansible necessitates that if redeploying then a running Reductionist container must be removed first.</p>
<h3 id="chunk-cache-key">Chunk Cache Key<a class="headerlink" href="#chunk-cache-key" title="Permanent link">&para;</a></h3>
<p>This defines the name of the key which should uniquely identify a downloaded chunk.
The default value is "%source-%bucket-%object-%offset-%size-%auth". All the parameters used here would be used in the API call to download an S3 object and so should uniquely identify an object.
The assumption is made that the object on the S3 data store doesn't change, i.e. replaced using different compression.</p>
<ul>
<li>Use insufficient parameters to uniquely identify a chunk and a request may be served with a cached chunk containing the wrong data</li>
<li>Use too many parameters, unnecessary ones, and we're missing out on cache hits</li>
</ul>
<h4 id="chunk-cache-key-tokens-available">Chunk Cache Key Tokens Available<a class="headerlink" href="#chunk-cache-key-tokens-available" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Token</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>%url</code></td>
<td>Source URL for the object</td>
</tr>
<tr>
<td><code>%offset</code></td>
<td>Offset of data byte range</td>
</tr>
<tr>
<td><code>%size</code></td>
<td>Size of data byte range</td>
</tr>
<tr>
<td><code>%dtype</code></td>
<td>Data type</td>
</tr>
<tr>
<td><code>%byte_order</code></td>
<td>Byte order of data</td>
</tr>
<tr>
<td><code>%compression</code></td>
<td>Type of compression used on data</td>
</tr>
<tr>
<td><code>%auth</code></td>
<td>Client credentials</td>
</tr>
</tbody>
</table>
<p>Where request parameters are optional, so may not be present in all requests, their tokens will always be usable with null values constructing the cache key.</p>
<h4 id="authenticating-cached-chunks">Authenticating Cached Chunks<a class="headerlink" href="#authenticating-cached-chunks" title="Permanent link">&para;</a></h4>
<p>The original request to download data from S3 will be authenticated.
Data cached from this request is likely subject to authentication also, to ensure a different Reductionist client can't read private data via the cache, there are three approaches that can be taken with authentication.</p>
<h5 id="no-authentication">No Authentication<a class="headerlink" href="#no-authentication" title="Permanent link">&para;</a></h5>
<p>Validating that a client is authorised to access a cached chunk will always add an overhead, however small, and it should be noted that the Reductionist doesn't maintain an internal state of authenticated clients vs chunks.
Performance will always be best when authentication is disabled which is achieved with the following configuration:</p>
<table>
<thead>
<tr>
<th>Environment Variable</th>
<th>Description</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>REDUCTIONIST_CHUNK_CACHE_KEY</td>
<td>"%source-%bucket-%object-%offset-%size"<code>| Namely the key should not contain</code>%auth`</td>
<td></td>
</tr>
<tr>
<td>REDUCTIONIST_CHUNK_CACHE_BYPASS_AUTH</td>
<td>true</td>
<td>Disable S3 authentication check prior to retrieving cached chunk</td>
</tr>
</tbody>
</table>
<h5 id="client-can-only-retrieve-chunks-that-they-cached">Client can only retrieve chunks that they cached<a class="headerlink" href="#client-can-only-retrieve-chunks-that-they-cached" title="Permanent link">&para;</a></h5>
<p>If authentication is required then the fastest option is to store cached chunks per client, with this approch two clients requesting the same chunk will each cache their own chunks independently.</p>
<table>
<thead>
<tr>
<th>Environment Variable</th>
<th>Description</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>REDUCTIONIST_CHUNK_CACHE_KEY</td>
<td>"%source-%bucket-%object-%offset-%size-%auth"<code>| Namely the key should contain</code>%auth`</td>
<td></td>
</tr>
<tr>
<td>REDUCTIONIST_CHUNK_CACHE_BYPASS_AUTH</td>
<td>true</td>
<td>Disable S3 authentication check prior to retrieving cached chunk</td>
</tr>
</tbody>
</table>
<p>The key name, once constructed from parameters, is <a href="https://en.wikipedia.org/wiki/MD5">MD5</a> encoded so credentials aren't exposed via the chunk cache filesystem.</p>
<h5 id="clients-can-retrieve-any-cached-chunks-to-which-s3-grants-access">Clients can retrieve any cached chunks to which S3 grants access<a class="headerlink" href="#clients-can-retrieve-any-cached-chunks-to-which-s3-grants-access" title="Permanent link">&para;</a></h5>
<p>If cached chunks are to be shared between clients then the Reductionist can perform a S3 authentication check prior to retrieving the cached chunk. There is an API call to the S3 object store associated with this so server and network latency will factor in, this approach should be benchmarked against the other authentication method documented above to see which best fits.</p>
<table>
<thead>
<tr>
<th>Environment Variable</th>
<th>Description</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>REDUCTIONIST_CHUNK_CACHE_KEY</td>
<td>"%source-%bucket-%object-%offset-%size"<code>| Namely the key should not contain</code>%auth`</td>
<td></td>
</tr>
<tr>
<td>REDUCTIONIST_CHUNK_CACHE_BYPASS_AUTH</td>
<td>true</td>
<td>Enable S3 authentication check prior to retrieving cached chunk</td>
</tr>
</tbody>
</table>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<p>Once deployed, the Reductionist API is accessible on port 8080 by HAProxy. The Prometheus UI is accessible on port 9090 on the host running Prometheus. The Jaeger UI is accessible on port 16686 on the host running Jaeger.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../api/" class="md-footer__link md-footer__link--prev" aria-label="Previous: API" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              API
            </div>
          </div>
        </a>
      
      
        
        <a href="../architecture/" class="md-footer__link md-footer__link--next" aria-label="Next: Architecture" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Architecture
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>